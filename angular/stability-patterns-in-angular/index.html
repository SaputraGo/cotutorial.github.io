<!DOCTYPE html>
<html lang="id-ID">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width">
    <meta name="google-site-verification" content="qMqQROYQaYZMrlMxnronbkhUycW3pBOAEH1QqdAbW1s" />
    <meta name="msvalidate.01" content="CEE7BB7D58F4339402A05A52C8D91A35" />
    <meta name="description"
        content="Hundreds of free tutorials for cutting edge languages and frameworks.">
    
    <meta name="author" content="Wisnu Saputra">
    <meta property="og:site_name" content="CoTutorial" />

    <title>Stability Patterns in Angular | CoTutorial</title>


    <link rel="icon" type="image/png" href="https://images.tutorialedge.net/images/favicon.ico">
    <link media="all" defer rel="stylesheet" href="https://use.typekit.net/jnu8xif.css">
    <link media="all" defer href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous">
    <link media="all" defer rel="stylesheet" href="https://cotutorial.github.io/css/style.css"> 
    <meta name="generator" content="Hugo 0.57.2" />
    <script src="../../js/jquery-3.4.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"
        integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o"
        crossorigin="anonymous"></script>
    <meta content='100023577212451' property='fb:admins' />
    <meta content="493615514813695" property="fb:app_id" />

</head>

<body>
    <div id="dynamicApp">
        <nav class="navbar navbar-expand-lg">
            
            <a class="navbar-brand" href="../../">
                <img alt="tutorialedge logo" src="../../images/svg/logo.svg" alt="CoTutorial">
                <span>CoTutorial</span>
            </a>
            

            
            <button class="navbar-toggler text-white" type="button" data-toggle="collapse"
                data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <img src="../../images/svg/hamburger.svg" alt="hamburger menu" />
            </button>
            

            <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/angular/"><img alt="angular logo"
                                src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="https://images.tutorialedge.net/images/angular.svg" /> Angular</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/typescript/"><img alt="angular logo"
                                src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="https://images.tutorialedge.net/images/typescript.png" /> TypeScript</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/cloud/"><img alt="cloud logo"
                                src="data:image/png.svg;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="https://images.tutorialedge.net/images/cloud.svg" /> Cloud</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/python/"><img alt="python logo"
                                src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="https://images.tutorialedge.net/images/python.svg" />Python</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/golang/"><img alt="golang logo"
                                src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="https://images.tutorialedge.net/images/golang.svg" />Golang</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/rust/"><img alt="rust logo"
                                src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="https://images.tutorialedge.net/images/rust-logo.png" />Rust</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="https://cotutorial.github.io/webdev/"><img alt="webdev logo"
                                src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="
                                data-src="../../images/svg/logo.svg" />Web Dev</a>
                    </li>
                </ul>

            </div>
        </nav>


<div class="top-bar">
    <div class="container">
        <h1>
            
            <img src="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" data-src="https://images.tutorialedge.net/images/angular.png" alt="Stability Patterns in Angular Image" />  Stability Patterns in Angular
        </h1>
        <div class="post-info">
            <div class="post-info-inner">
                <span>
            
            <img class="author" src="../../images/svg/logo.svg" alt="TutorialEdge Logo" />
            
            <a href="https://twitter.com/mathieunls">Mathieu Nayrolles</a>
          </span>

                <span><img class="icon" src="https://tutorialedge.net/images/svg/clock.svg" alt="clock"/>11 Minutes</span>
                <span><img class="icon" src="https://tutorialedge.net/images/svg/calendar.svg" alt="clock"/> Oct 22, 2018</span>

                <span>
            
            <a href="../../tags/angular"
              ><span class="badge badge-pill badge-info">angular</span></a>
                
                </span>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="content-container">
        <div class="row">

            <div class="d-none d-sm-none col-sm-3 d-md-block">
                <div class="sidebar">
                    <div id="sidebar small-no-show">

  <div class="right-sidebar youtube-subscribe">
    <h3>Site Sponsors</h3>
    <a href="#"><img class="patron" src="https://images.tutorialedge.net/images/DigitalOcean.png" style="width: 100%; height: auto; margin: 0; " alt="Amazing Site Sponsors!"/></a>
    <hr/>
    <h3>Support The Site</h3>
    <a href="#"><img class="patron" src="https://images.tutorialedge.net/images/patreon.png" alt="become a patron"/></a>
    <div class="clear"></div>
    <a href="#"><img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee" style="height: auto !important;width: auto !important;" ></a>
  </div>


  <div class="right-sidebar small-no-show">
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    <h4 style="text-transform: uppercase;">books</h4>
    <ul class="collection">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li class="collection-item"><a href="https://cotutorial.github.io/angular/best-books-for-learning-angular/">The Top Books For Learning Angular</a></li>
      
      
      
      
    </ul>
    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    <h4 style="text-transform: uppercase;">socket.io</h4>
    <ul class="collection">
      
      
      
      
      
      
      <li class="collection-item"><a href="https://cotutorial.github.io/angular/angular-socket-io-tutorial/">Creating a Realtime App with Angular and Socket.io Tutorial</a></li>
      
      
    </ul>
    
    

    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    
    
    

    
    

    
    
    
    

    
    
  </div>

</div>
                </div>
            </div>

            <div class="col-sm-9 col-md-7">
                <article class="content" v-pre>
                    

<p>Stability is one of the cornerstones of software engineering. No matter what,
you must expect the worst from your environment and your users, and be prepared
for it. Your Angular applications should be able to operate in a degraded mode
when your backend is burning and smoothly recover when it comes back online. In
this article, you’ll learn about stability patterns, timeouts and the circuit
breaker.</p>

<h1 id="timeouts">Timeouts</h1>

<p>You can never trust an API to work as expected, even if it is your own API. You
should always expect everything that can go wrong to, well, go wrong. One of the
less harmful things that can happen when trying to communicate with your backend
is that it won&rsquo;t respond. While this one-way communication is harmless for your
Angular applications, it is most frustrating for your users.</p>

<p>Fortunately, there is a very simple way to prevent your user from getting
frustrated about unresponsive APIs: timeouts. A timeout is a simple defense
mechanism that allows your application to wait a fixed amount of time and not a
millisecond more. Create a new project to test it out: ng new timeoutcd
timeoutng g service API</p>

<p>This will create a new project and a service called API. In the first glance,
there is not much to look at:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiService</span> {

  <span style="color:#66d9ef">constructor</span>() { }

}
<span style="color:#a6e22e">Add</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">HttpClient</span> <span style="color:#a6e22e">component</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">app</span>.<span style="color:#66d9ef">module</span><span style="color:#a6e22e">.ts</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">follows</span>:
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">BrowserModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/platform-browser&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">NgModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClientModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/common/http&#39;</span>;

<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">AppComponent</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./app.component&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ApiService</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./api.service&#39;</span>;

<span style="color:#66d9ef">@NgModule</span>({
  <span style="color:#a6e22e">declarations</span><span style="color:#f92672">:</span> [
    <span style="color:#a6e22e">AppComponent</span>
  ],
  <span style="color:#a6e22e">imports</span><span style="color:#f92672">:</span> [
    <span style="color:#a6e22e">BrowserModule</span>,
    <span style="color:#a6e22e">HttpClientModule</span>
  ],
  <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">ApiService</span>],
  <span style="color:#a6e22e">bootstrap</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">AppComponent</span>]
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppModule</span> { }</code></pre></div>
<p>Now, inject the HttpClient component into your API service client in order to
have access to its methods:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/core&#34;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/common/http&#34;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiService</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">http</span>: <span style="color:#66d9ef">HttpClient</span>) {}
}</code></pre></div>
<p>Add a new method in APIService, which simply makes an http.get request to the
GitHub repository that contains the code for this article
(<a href="https://github.com/MathieuNls/Angular-Design-Patterns-and-Best-Practices):">https://github.com/MathieuNls/Angular-Design-Patterns-and-Best-Practices):</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/core&#34;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/common/http&#34;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiService</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">http</span>: <span style="color:#66d9ef">HttpClient</span>) {}

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">getURL</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">data</span> <span style="color:#f92672">=&gt;</span> {
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">data</span>);
    });
  }
}</code></pre></div>
<p>This is followed by an injection of ApiService and a call to the
new getURL method in the AppComponent:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Component</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/core&#34;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ApiService</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;./api.service&#34;</span>;

<span style="color:#66d9ef">@Component</span>({
  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;app-root&#34;</span>,
  <span style="color:#a6e22e">templateUrl</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;./app.component.html&#34;</span>,
  <span style="color:#a6e22e">styleUrls</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;./app.component.css&#34;</span>]
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppComponent</span> {
  <span style="color:#a6e22e">title</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;app&#34;</span>;

  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">api</span>: <span style="color:#66d9ef">ApiService</span>) {
    <span style="color:#a6e22e">api</span>.<span style="color:#a6e22e">getURL</span>(
      <span style="color:#e6db74">&#34;https://github.com/MathieuNls/Angular-Design-Patterns-and-Best-Practices&#34;</span>
    );
  }
}</code></pre></div>
<p>Now, if you were to execute this, you would have a gracious HTTP response, and
the HTML of the web page would be printed out in the console. The problem,
however, is that you have no countermeasure in place in the case
that github.com is down and does not respond:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/core&#34;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/common/http&#34;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiService</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">http</span>: <span style="color:#66d9ef">HttpClient</span>) {}

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">getURL</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">timeout</span>;

    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">sub</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">res</span> <span style="color:#f92672">=&gt;</span> {
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
      <span style="color:#a6e22e">clearTimeout</span>(<span style="color:#a6e22e">timeout</span>);
    });

    <span style="color:#a6e22e">timeout</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setTimeout</span>(() <span style="color:#f92672">=&gt;</span> {
      <span style="color:#a6e22e">sub</span>.<span style="color:#a6e22e">unsubscribe</span>();
    }, <span style="color:#ae81ff">1000</span>);
  }
}</code></pre></div>
<p>In this version of the getURL function, you must first declare a timeout
variable that will contain a NodeJS timeout. Then, instead of performing a
regular HTTP.get, you will subscribe to the response. Finally, after the
subscription to the result, assign the timeout variable with
the setTimeout function.</p>

<p>Use this function to unsubscribe from the response after 1,000 ms. You only wait
one second for the http reply. If the reply does not arrive within that time,
you automatically unsubscribe and allow your application to continue. Of course,
your users will have to be warned in some way that the operation was
unsuccessful.</p>

<h1 id="circuit-breaker">Circuit breaker </h1>

<p>The timeout pattern is efficient at protecting the patience of your users and,
ultimately, your Angular application. However, in the case that the API is not
responding because something went wrong on the server side, say 80% of your
server is down and the remaining 20% is trying to manage the load, your clients
will most likely repeatedly retry the action that timed out. This puts even more
stress on your dying backend infrastructure.</p>

<p>A circuit is an automatic device for stopping the flow of the current in an
electric circuit as a safety measure. Circuit breakers are used to detect
failures and encapsulate the logic of preventing a failure from reoccurring
constantly (during maintenance, temporary external system failure, or unexpected
system difficulties).</p>

<p>Within the framework of an Angular app, a circuit breaker will prevent the
client from performing API requests when there are too many failures. After a
given amount of time, the circuit will allow some of the queries to go through
and consume the API. If these queries return without any problems, then the
circuit will close itself and allow all the requests to go through:</p>

<p>In the preceding diagram, you can see how the circuit breaker operates. All
requests go through the circuit breaker, and if the supplier answers the
requests in time, the circuit stays closed. When problems start occurring, the
circuit breaker notices this, and if enough requests time out, then the circuit
opens and prevents requests from going through.</p>

<p>Finally, after a given amount of time, the circuit breaker tries to resend
requests to the supplier:</p>

<p>From an implementation point of view, you’ll need
the ApiStatus and Call classes, which are responsible for keeping track of the
call you make to diverse APIs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#75715e">//ApiStatus class
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiStatus</span> {
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">lastFail</span>: <span style="color:#66d9ef">number</span>;
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">calls</span>: <span style="color:#66d9ef">Call</span>[];

  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>) {}

  <span style="color:#75715e">//Compute the fail percentage
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">failPercentage</span>(<span style="color:#a6e22e">timeWindow</span>: <span style="color:#66d9ef">number</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">number</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fail</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">time</span> <span style="color:#f92672">&gt;</span> Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">-</span> <span style="color:#a6e22e">timeWindow</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">status</span>) {
        <span style="color:#a6e22e">success</span><span style="color:#f92672">++</span>;
      } <span style="color:#66d9ef">else</span> {
        <span style="color:#a6e22e">fail</span><span style="color:#f92672">++</span>;
      }
      <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span>;
    }

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fail</span> <span style="color:#f92672">/</span> (<span style="color:#a6e22e">fail</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">success</span>);
  }
}</code></pre></div>
<p>The APIStatus contains the statistics for the on root API. Take into account
that you might use several APIs in your application. Each API has to be linked
to its own circuit breaker. First, you have the lastFail variable, which
contains the date at which the last call to this API failed.</p>

<p>Then, you have a calls array that contains all the calls made to a given API. In
addition to the constructor that defines the URL property, you have
the failPercentage function. This function is responsible for computing the
percentage of calls that failed within the timeWindows time. To do this, iterate
over all the calls in a reverse chronological order until you
reach Date.now()–timeWindow or the end of the calls array.</p>

<p>Within the while loop, increment two number variables called success and
fail with regard to the status of the current call. In the end, return the
percentage of failed calls. This percentage will be used to determine the status
of the circuit breaker.</p>

<p>The Call class is rather simple:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#75715e">//An Api Call
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Call</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">time</span>: <span style="color:#66d9ef">number</span>, <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">status</span>: <span style="color:#66d9ef">boolean</span>) {}
}</code></pre></div>
<p>It only contains two properties: time and status. You’re now ready to implement
an API client for your Angular app that implements a circuit breaker. First,
create the class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/common/http&#39;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiwithBreakerService</span> {

  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">http</span>: <span style="color:#66d9ef">HttpClient</span>) { }</code></pre></div>
<p>Then, add the property for ApiwithBreakerService:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">apis</span>: <span style="color:#66d9ef">Map</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">ApiStatus</span><span style="color:#f92672">&gt;</span>;
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">failPercentage</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>;
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">timeWindow</span> : <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span><span style="color:#f92672">*</span><span style="color:#ae81ff">60</span><span style="color:#f92672">*</span><span style="color:#ae81ff">24</span>;
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">timeToRetry</span> : <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>;</code></pre></div>
<p>These properties will allow you to implement the circuit breaker pattern. First,
you have a map of string, an ApiStatus that is used to store the API status of
many APIs. Then, you have failPercentage, which defines how many calls can fail,
as a percentage, before you open the circuit.</p>

<p>The timeWindow variable defines the amount of time that is used to
compute failPercentage. Here, you have a maximum of 20% of calls that can fail
within a 24-hour window before you open this circuit and prevent other calls
from being made. Finally, you have timeToRetry, which states how long you have
to wait before trying to reclose the circuit.</p>

<p>Here is the modified getURL function from the timeout section:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">  <span style="color:#75715e">//Http get an url
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">getURL</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> {

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rootUrl</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">extractRootDomain</span>(<span style="color:#a6e22e">url</span>);

    <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isClosed</span>(<span style="color:#a6e22e">rootUrl</span>) <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">readyToRetry</span>(<span style="color:#a6e22e">rootUrl</span>)){
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">timeout</span>;

      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">sub</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>)
        .<span style="color:#a6e22e">subscribe</span>((<span style="color:#a6e22e">res</span>) <span style="color:#f92672">=&gt;</span> {
          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
          <span style="color:#a6e22e">clearTimeout</span>(<span style="color:#a6e22e">timeout</span>);
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addCall</span>(<span style="color:#a6e22e">rootUrl</span>, <span style="color:#66d9ef">true</span>);
        });

      <span style="color:#a6e22e">timeout</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setTimeout</span>(
        () <span style="color:#f92672">=&gt;</span> {
          <span style="color:#a6e22e">sub</span>.<span style="color:#a6e22e">unsubscribe</span>();
          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addCall</span>(<span style="color:#a6e22e">rootUrl</span>, <span style="color:#66d9ef">false</span>);
        }, <span style="color:#ae81ff">1000</span>
      );
    }
  }</code></pre></div>
<p>The core functionalities are same as the previous section with the timeout, but
they are embedded in an if statement:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isClosed</span>(<span style="color:#a6e22e">rootUrl</span>) <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">readyToRetry</span>(<span style="color:#a6e22e">rootUrl</span>))</code></pre></div>
<p>The if statement checks if the circuit is closed or if you are ready to retry on
an open circuit. You can also add calls to the addCall function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">  <span style="color:#75715e">//Add a call
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">addCall</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">status</span>: <span style="color:#66d9ef">boolean</span>) {

    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>);

    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
      <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ApiStatus</span>(<span style="color:#a6e22e">url</span>);
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">res</span>);
    }

    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Call</span>(Date.<span style="color:#a6e22e">now</span>(), <span style="color:#a6e22e">status</span>));

    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">status</span>){
      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">lastFail</span> <span style="color:#f92672">=</span> Date.<span style="color:#a6e22e">now</span>();
    }
  }</code></pre></div>
<p>The addCall function adds a new call to an ApiStatus that&rsquo;s stored inside
the apis map. It also updates the lastFail properties of the ApiStatus instance
if the call was unsuccessful.</p>

<p>What remains are the readyToRetry and isClosed functions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">  <span style="color:#75715e">//Are we ready to retry
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">readyToRetry</span>(<span style="color:#a6e22e">url</span>:<span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">boolean</span> {

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">lastFail</span> <span style="color:#f92672">&lt;</span> (Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">-</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timeToRetry</span>)
  }

  <span style="color:#75715e">//Is it closed ?
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">isClosed</span>(<span style="color:#a6e22e">url</span> :<span style="color:#66d9ef">string</span>) <span style="color:#f92672">:</span> <span style="color:#66d9ef">boolean</span> {

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span>
      <span style="color:#f92672">!</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">failPercentage</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timeWindow</span>) <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">failPercentage</span>);
  }</code></pre></div>
<p>In the readyToRetry function, simply check that the latest fail is older than
the time it is now minus timeToRetry. In the isClosed function, check if the
percentage of failed calls during the time window is greater than the maximum
allowed. Here is the complete implementation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/core&#34;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClient</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@angular/common/http&#34;</span>;

<span style="color:#75715e">//ApiStatus class
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiStatus</span> {
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">lastFail</span>: <span style="color:#66d9ef">number</span>;
  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">calls</span>: <span style="color:#66d9ef">Call</span>[];

  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>) {}

  <span style="color:#75715e">//Compute the fail percentage
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">failPercentage</span>(<span style="color:#a6e22e">timeWindow</span>: <span style="color:#66d9ef">number</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">number</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">success</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fail</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">time</span> <span style="color:#f92672">&gt;</span> Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">-</span> <span style="color:#a6e22e">timeWindow</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">calls</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">status</span>) {
        <span style="color:#a6e22e">success</span><span style="color:#f92672">++</span>;
      } <span style="color:#66d9ef">else</span> {
        <span style="color:#a6e22e">fail</span><span style="color:#f92672">++</span>;
      }
      <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span>;
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fail</span> <span style="color:#f92672">/</span> (<span style="color:#a6e22e">fail</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">success</span>);
  }
}

<span style="color:#75715e">//An Api Call
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Call</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">time</span>: <span style="color:#66d9ef">number</span>, <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">status</span>: <span style="color:#66d9ef">boolean</span>) {}
}

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApiwithBreakerService</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">http</span>: <span style="color:#66d9ef">HttpClient</span>) {}

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">apis</span>: <span style="color:#66d9ef">Map</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">ApiStatus</span><span style="color:#f92672">&gt;</span>;
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">failPercentage</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>;
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">timeWindow</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span>;
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">timeToRetry</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>;

  <span style="color:#75715e">//Http get an url
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">getURL</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rootUrl</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">extractRootDomain</span>(<span style="color:#a6e22e">url</span>);

    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">isClosed</span>(<span style="color:#a6e22e">rootUrl</span>) <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">readyToRetry</span>(<span style="color:#a6e22e">rootUrl</span>)) {
      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">timeout</span>;

      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">sub</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">res</span> <span style="color:#f92672">=&gt;</span> {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>);
        <span style="color:#a6e22e">clearTimeout</span>(<span style="color:#a6e22e">timeout</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addCall</span>(<span style="color:#a6e22e">rootUrl</span>, <span style="color:#66d9ef">true</span>);
      });

      <span style="color:#a6e22e">timeout</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setTimeout</span>(() <span style="color:#f92672">=&gt;</span> {
        <span style="color:#a6e22e">sub</span>.<span style="color:#a6e22e">unsubscribe</span>();
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">addCall</span>(<span style="color:#a6e22e">rootUrl</span>, <span style="color:#66d9ef">false</span>);
      }, <span style="color:#ae81ff">1000</span>);
    }
  }

  <span style="color:#75715e">//Add a call
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">addCall</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">status</span>: <span style="color:#66d9ef">boolean</span>) {
    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>);

    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
      <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ApiStatus</span>(<span style="color:#a6e22e">url</span>);
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">res</span>);
    }

    <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">calls</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Call</span>(Date.<span style="color:#a6e22e">now</span>(), <span style="color:#a6e22e">status</span>));

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">status</span>) {
      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">lastFail</span> <span style="color:#f92672">=</span> Date.<span style="color:#a6e22e">now</span>();
    }
  }

  <span style="color:#75715e">//Are we ready to retry
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">readyToRetry</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">boolean</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">lastFail</span> <span style="color:#f92672">&lt;</span> Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">-</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timeToRetry</span>;
  }

  <span style="color:#75715e">//Is it closed ?
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">isClosed</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">boolean</span> {
    <span style="color:#66d9ef">return</span> (
      <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span>
      <span style="color:#f92672">!</span>(
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">apis</span>.<span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">url</span>).<span style="color:#a6e22e">failPercentage</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timeWindow</span>) <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">failPercentage</span>
      )
    );
  }

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">extractHostname</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">hostname</span>;
    <span style="color:#75715e">//find &amp; remove protocol (http, ftp, etc.) and get hostname
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#e6db74">&#34;://&#34;</span>) <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
      <span style="color:#a6e22e">hostname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;/&#34;</span>)[<span style="color:#ae81ff">2</span>];
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#a6e22e">hostname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;/&#34;</span>)[<span style="color:#ae81ff">0</span>];
    }

    <span style="color:#75715e">//find &amp; remove port number
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">hostname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hostname</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;:&#34;</span>)[<span style="color:#ae81ff">0</span>];
    <span style="color:#75715e">//find &amp; remove &#34;?&#34;
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">hostname</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hostname</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;?&#34;</span>)[<span style="color:#ae81ff">0</span>];

    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hostname</span>;
  }

  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">extractRootDomain</span>(<span style="color:#a6e22e">url</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">domain</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">extractHostname</span>(<span style="color:#a6e22e">url</span>),
      <span style="color:#a6e22e">splitArr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">domain</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;.&#34;</span>),
      <span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">splitArr</span>.<span style="color:#a6e22e">length</span>;

    <span style="color:#75715e">//extracting the root domain here
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//if there is a subdomain
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>) {
      <span style="color:#a6e22e">domain</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">splitArr</span>[<span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">splitArr</span>[<span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
      <span style="color:#75715e">//check to see if it&#39;s using a Country Code Top Level Domain (ccTLD) (i.e. &#34;.me.uk&#34;)
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (
        <span style="color:#a6e22e">splitArr</span>[<span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&amp;&amp;</span>
        <span style="color:#a6e22e">splitArr</span>[<span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>
      ) {
        <span style="color:#75715e">//this is using a ccTLD
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">domain</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">splitArr</span>[<span style="color:#a6e22e">arrLen</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">3</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">domain</span>;
      }
    }
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">domain</span>;
  }
}</code></pre></div>
<p>Note that you have two helper functions that do not directly participate in the
implementation of the circuit patterns, only extracting the root URL of a call
in order to compute a shared status by root APIs. Thanks to these helper
functions, you can
have <a href="http://someapi.com/users and http://someapi.com/sales share">http://someapi.com/users and http://someapi.com/sales share</a>
the same status, while <a href="http://anotherapi.com/someCall has">http://anotherapi.com/someCall has</a> its own
separated ApiStatus.</p>

<p>The timeout and the circuit breaker patterns work in parallel in order to reduce
self-denial. Self-denial is the art of dooming your backend servers yourself.
This tends to happen when you have an application behaving improperly and making
thousands of calls per second to your backend architecture.</p>

<p>If you found this article interesting, you can explore Mathieu Nayrolles’
<a href="https://amzn.to/2T4TRmS">Angular Design Patterns</a> to make the most of Angular
by leveraging design patterns and best practices to build stable and high
performing apps. Angular Design Patterns is an insightful journey through the
most valuable design patterns, and it will provide clear guidance on how to use
them effectively in Angular.</p>
 
<div class="author-container">
  <div class="author-image">
    
    <img src="../../images/svg/logo.svg" alt="Mathieu Nayrolles" />
    
  </div>
  <div class="author-info">
    <h2>
      Mathieu Nayrolles<br />
      <small
        >Twitter: <a href="https://twitter.com/mathieunls">@CoTutorial</a></small
      >
    </h2>
    <p>
      Hey, I'm Elliot and I've been working on TutorialEdge for the last 4 years! If my work has helped you in any way, shape, or form then please consider supporting my work.
    </p>

    <a style="float: left; margin-right: 10px;" href="#"><img class="patron" src="https://images.tutorialedge.net/images/patreon.png" alt="become a patron"/></a>
    <a style="float: left;" href="#"><img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee" style="height: auto !important;width: auto !important;" ></a>
    
  </div>
</div>


                </article>
                <div class="comments">
          <div class="content">
    
    
    

    <script>
        function loadAPI() {
            var js = document.createElement('script');
            js.src = '//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v4.0&appId=493615514813695&autoLogAppEvents=1';
            document.body.appendChild(js);
        }
        window.onscroll = function () {
            var rect = document.getElementById('comments').getBoundingClientRect();
            if (rect.top < window.innerHeight) {
                loadAPI();
                window.onscroll = null;
            } 
        }
        </script>
    <div id="fb-root"></div>
    <div class="fb-comments comments" id="comments" data-href="https://cotutorial.github.io/angular/stability-patterns-in-angular/" data-width="100%" data-numposts="5"></div>                  
</div>

        </div>
            </div>

            <div class="col-sm-3 col-md-2">
                <div id="right-sidebar">
                    <div class="toc">
                        <h4>Table Of Contents</h4>
                        <nav id="TableOfContents">
<ul>
<li><a href="#timeouts">Timeouts</a></li>
<li><a href="#circuit-breaker">Circuit breaker </a></li>
</ul>
</nav>
                    </div>
                    <hr/>
                    <div id="codefund">
                        
                    </div>
                    <script src="https://codefund.io/properties/330/funder.js" async="async"></script>
                    <div class="clear"></div>
                </div>
            </div>

        </div>
    </div>
</div>


<script src="../../js/sticky-sidebar.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.0/anchor.min.js"></script>
<script>
    
    document.addEventListener("DOMContentLoaded", function(event) {
        var sidebar = new StickySidebar("#right-sidebar", {
            topSpacing: 10
        });
        anchors.options = {
            visible: "always",
            placement: "left"
        };
        anchors.add(
            ".content > h1, .content > h2, .content > h3, .content > h4"
        );
    });
</script>


<div class="blue-spacer"></div>

<footer class="page-footer">
    <div class="row">
        <div class="col l3 m6 s12">
            <div class="padded">
                <h3>Courses</h3>
                <ul>
                    <li><a href="https://cotutorial.github.io/python/">Python</a></li>
                    <li><a href="https://cotutorial.github.io/angular/">Angular</a></li>
                    <li><a href="https://cotutorial.github.io/golang/">Golang</a></li>
                    <li><a href="https://cotutorial.github.io/artificial-intelligence/">Artificial Intelligence</a></li>
                    <li><a href="https://cotutorial.github.io/webdev/">Web Development</a></li>
                </ul>
            </div>
        </div>
        <div class="col l3 m6 s12">
            <div class="padded">
                <h3>Quick Links</h3>

                <ul>
                    <li><a href="https://cotutorial.github.io/search/">Search Page</a></li>
                    <li><a href="https://cotutorial.github.io/about/">About</a></li>
                    <li><a href="https://cotutorial.github.io/get-involved/">Get Involved</a></li>
                </ul>
                <h3>Suggested Resources</h3>
                <ul>
                    <li><a href="https://cotutorial.github.io/uses/">My Hardware + Software Recording Setup </a></li>
                </ul>
            </div>
        </div>
        <div class="col l3 m6 s12">
            <div class="padded">
                <h3>Follow Me</h3>
                <ul>
                    <li><a href="https://twitter.com/wisnusaputradev">@wisnusaputradev</a></li>
                    <li><a href="https://www.facebook.com/wisnusaputradev">Wisnu Saputra</a></li>
                    <li><a href="https://github.com/saputrago">saputrago</a></li>
                </ul>
            </div>
        </div>
        <div class="col l3 m12 s12 footer-special">
            <div class="logo">
                <a href="https://cotutorial.github.io/"><img alt="tutorialedge logo" src="../../images/svg/logo.svg" /> CoTutorial</a>
            </div>
            <div class="padded">
                <p>CoTutorial is a totally free programming tutorial site that has been built with the intention of helping as many people as possible learn to program. The site is also completely opensourced and you can contribue here: <a href="https://github.com/saputrago">Project</a>,
                    any pull requests will be greatly appreciated!</p>
            </div>
        </div>
    </div>
    <div class="footer-copyright none">
        <span class="float-left">CoTutorial © 2019 Copyright</span>
        <span class="float-right" id="page-id">ef06a7c087798958a73f09dbaebdd7d4</span>
    </div>
</footer>



<script async src="https://www.googletagmanager.com/gtag/js?id=UA-10255990-23"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-10255990-23');
</script>
<script type="text/javascript">
    function init() {
        var imgDefer = document.getElementsByTagName('img');
        
        
        
        
        
        for (var i = 0; i < imgDefer.length; i++) {
            if (imgDefer[i].getAttribute('data-src')) {
                imgDefer[i].setAttribute('src', imgDefer[i].getAttribute('data-src'));
            }
        }

    }

    window.onload = init;
</script>

</div>
</body>

</html>